<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF/Excel ë³´ê³ ì„œ ìƒì„±ê¸°</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; color: #333; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1 { color: #4c6ef5; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { background-color: #4c6ef5; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; transition: background-color 0.3s; }
        button:hover { background-color: #3b5bdb; }
        .result-section { margin-top: 30px; padding-top: 20px; border-top: 1px dashed #ccc; }
        .file-link { display: inline-block; margin-right: 15px; padding: 10px 15px; border-radius: 5px; text-decoration: none; font-weight: bold; }
        .file-link.pdf { background-color: #ff4b4b; color: white; }
        .file-link.excel { background-color: #28a745; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“‘ ë°œí‘œ í‰ê°€ ë³´ê³ ì„œ ìƒì„±ê¸°</h1>

        <div class="input-group">
            <label for="topicInput">ğŸ“ ë°œí‘œ ì£¼ì œ</label>
            <input type="text" id="topicInput" value="AI ê¸°ë°˜ í—¬ìŠ¤ì¼€ì–´"> 
        </div>
        
        <div class="input-group">
            <label for="teamNameInput">ğŸ‘¥ íŒ€ëª…</label>
            <input type="text" id="teamNameInput" value="í…ŒìŠ¤íŠ¸íŒ€">
        </div>

        <button onclick="generateReport()">ğŸš€ PDF/Excel ìƒì„± ìš”ì²­</button>
        <p id="statusMessage" style="margin-top: 15px;"></p>

        <div class="result-section" id="resultSection" style="display:none;">
            <h2>âœ… ìƒì„± ê²°ê³¼ ë° ë‹¤ìš´ë¡œë“œ</h2>
            <p>
                <a href="#" id="pdfDownloadLink" class="file-link pdf" style="display:none;">ğŸ“„ PDF ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ</a>
                <a href="#" id="excelDownloadLink" class="file-link excel" style="display:none;">ğŸ“Š ì—‘ì…€ ìš”ì•½ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</a>
            </p>

            <h3>ì±„ì  ê²°ê³¼ (í•˜ë“œ ì½”ë”©)</h3>
            <div id="gradingDisplay">
                <p><strong>ì´ì :</strong> 0ì  / 10ì </p>
                <div style="border: 1px solid #eee; padding: 10px; border-radius: 5px;">
                    <strong>í•­ëª©:</strong> ì°½ì˜ì„± (10ì  ë§Œì ) <br>
                    <strong>íšë“ ì ìˆ˜:</strong> 0ì  <br>
                    <strong>í”¼ë“œë°±:</strong> ë°œí‘œ ë‚´ìš©ì´ ì œê³µë˜ì§€ ì•Šì•„ ì°½ì˜ì„±ì„ í‰ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°œí‘œ ë‚´ìš©ì„ ì œê³µí•´ ì£¼ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

    <script>
        const FLASK_URL = 'http://127.0.0.1:5000'; 

        async function generateReport() {
            const teamName = document.getElementById('teamNameInput').value.trim();
            const presentationTopic = document.getElementById('topicInput').value.trim();
            const statusMessage = document.getElementById('statusMessage');
            
            if (!teamName || !presentationTopic) {
                statusMessage.textContent = 'âš ï¸ íŒ€ëª…ê³¼ ë°œí‘œ ì£¼ì œë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
                statusMessage.style.color = 'red';
                return;
            }

            // ìš”ì²­ì„ ìœ„í•œ í•˜ë“œ ì½”ë”© ë°ì´í„°
            const criteria = [
                { "name": "ì°½ì˜ì„±", "description": "ìƒˆë¡œìš´ ê´€ì ì—ì„œ ì£¼ì œë¥¼ í•´ì„í–ˆëŠ”ê°€?", "weight": 10 }
            ];
            
            const gradingResult = [
                { "score": "0", "feedback": "ë°œí‘œ ë‚´ìš©ì´ ì œê³µë˜ì§€ ì•Šì•„ ì°½ì˜ì„±ì„ í‰ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°œí‘œ ë‚´ìš©ì„ ì œê³µí•´ ì£¼ì„¸ìš”." }
            ];

            const requestData = {
                teamName: teamName,
                presentationTopic: presentationTopic,
                criteria: criteria,
                gradingResult: gradingResult
            };

            statusMessage.textContent = 'ğŸš€ ë³´ê³ ì„œ ìƒì„± ìš”ì²­ ì¤‘...';
            statusMessage.style.color = '#4c6ef5';
            
            try {
                const response = await fetch(FLASK_URL + '/generate_report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (response.ok) {
                    statusMessage.textContent = 'âœ… ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ! ì ì‹œ í›„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.';
                    statusMessage.style.color = 'green';
                    
                    const pdfLink = document.getElementById('pdfDownloadLink');
                    const excelLink = document.getElementById('excelDownloadLink');
                    
                    const safeTopic = presentationTopic.replace(/ /g, '_').replace(/[\\/*?:"<>|]/g, '');
                    
                    pdfLink.href = `${FLASK_URL}/download/pdf/${encodeURIComponent(teamName)}`;
                    excelLink.href = `${FLASK_URL}/download/excel/${encodeURIComponent(safeTopic)}`;

                    pdfLink.style.display = 'inline-block';
                    excelLink.style.display = 'inline-block';
                    document.getElementById('resultSection').style.display = 'block';

                } else {
                    statusMessage.textContent = `âŒ ìƒì„± ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
                    statusMessage.style.color = 'red';
                }

            } catch (error) {
                statusMessage.textContent = `â— ì„œë²„ ì—°ê²° ì‹¤íŒ¨: Flask ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”. (${error.message})`;
                statusMessage.style.color = 'red';
            }
        }
    </script>
</body>
</html>